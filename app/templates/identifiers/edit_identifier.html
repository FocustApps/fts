<div class="container">
    <button class="btn btn-sm btn-primary" hx-get="{{ url_for(view_url) }}" hx-target="#pageContent"
        hx-swap="innerHTML">
        Back to Identifiers
    </button>
    <button class="btn btn-sm btn-info" hx-get="/identifiers/{{ identifier.id }}" hx-target="#pageContent"
        hx-swap="innerHTML">
        View Identifier
    </button>

    <div class="container">
        <section style="width: 50vw;">
            <div id="form-messages"></div>
            <form id="editIdentifierForm" hx-post="/v1/identifiers/{{ identifier.id }}/edit" hx-target="#form-messages"
                hx-swap="innerHTML">
                <h3>Edit Identifier</h3>

                <div class="form-group mb-3">
                    <label for="page_id" class="form-label">Page:</label>
                    <input type="hidden" id="page_id" name="page_id" value="{{ identifier.page_id }}">
                    <input type="text" class="form-control" value="{{ page.page_name }} (ID: {{ identifier.page_id }})"
                        readonly>
                    <small class="form-text text-muted">Page cannot be changed when editing an identifier</small>
                </div>

                <div class="form-group mb-3">
                    <label for="element_name" class="form-label">Element Name:</label>
                    <input type="text" id="element_name" name="element_name" class="form-control" required
                        value="{{ identifier.element_name }}" placeholder="login_button" maxlength="96">
                    <small class="form-text text-muted">Unique name for this element (e.g., login_button,
                        username_field)</small>
                </div>

                <div class="form-group mb-3">
                    <label for="locator_strategy" class="form-label">Locator Strategy:</label>
                    <select id="locator_strategy" name="locator_strategy" class="form-select" required>
                        <option value="">Select strategy...</option>
                        <option value="xpath" {% if identifier.locator_strategy=='xpath' %}selected{% endif %}>XPath
                        </option>
                        <option value="css" {% if identifier.locator_strategy=='css' %}selected{% endif %}>CSS Selector
                        </option>
                        <option value="id" {% if identifier.locator_strategy=='id' %}selected{% endif %}>ID</option>
                        <option value="name" {% if identifier.locator_strategy=='name' %}selected{% endif %}>Name
                        </option>
                        <option value="class_name" {% if identifier.locator_strategy=='class_name' %}selected{% endif
                            %}>Class Name</option>
                        <option value="tag_name" {% if identifier.locator_strategy=='tag_name' %}selected{% endif %}>Tag
                            Name</option>
                        <option value="link_text" {% if identifier.locator_strategy=='link_text' %}selected{% endif %}>
                            Link Text</option>
                        <option value="partial_link_text" {% if identifier.locator_strategy=='partial_link_text'
                            %}selected{% endif %}>Partial Link Text</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="locator_query" class="form-label">Locator Query:</label>
                    <textarea id="locator_query" name="locator_query" class="form-control" required
                        placeholder="//button[@id='login']" rows="3"
                        maxlength="255">{{ identifier.locator_query }}</textarea>
                    <small class="form-text text-muted">The selector query for finding this element</small>
                </div>

                <div class="form-group mb-3">
                    <label for="action" class="form-label">Action (optional):</label>
                    <select id="action" name="action" class="form-select">
                        <option value="" {% if not identifier.action or identifier.action=='None' %}selected{% endif %}>
                            No specific action</option>
                        <option value="click" {% if identifier.action=='click' %}selected{% endif %}>Click</option>
                        <option value="type" {% if identifier.action=='type' %}selected{% endif %}>Type/Input</option>
                        <option value="hover" {% if identifier.action=='hover' %}selected{% endif %}>Hover</option>
                        <option value="submit" {% if identifier.action=='submit' %}selected{% endif %}>Submit</option>
                        <option value="select" {% if identifier.action=='select' %}selected{% endif %}>Select</option>
                        <option value="scroll" {% if identifier.action=='scroll' %}selected{% endif %}>Scroll</option>
                        <option value="wait" {% if identifier.action=='wait' %}selected{% endif %}>Wait</option>
                        <option value="verify" {% if identifier.action=='verify' %}selected{% endif %}>Verify</option>
                    </select>
                    <small class="form-text text-muted">What action to perform on this element</small>
                </div>

                <div class="form-group mb-3">
                    <label class="form-label">Environments:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="dev" id="env_dev" name="environments" {%
                            if "dev" in identifier.environments %}checked{% endif %}>
                        <label class="form-check-label" for="env_dev">Development</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="staging" id="env_staging"
                            name="environments" {% if "staging" in identifier.environments %}checked{% endif %}>
                        <label class="form-check-label" for="env_staging">Staging</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="prod" id="env_prod" name="environments"
                            {% if "prod" in identifier.environments %}checked{% endif %}>
                        <label class="form-check-label" for="env_prod">Production</label>
                    </div>
                    <small class="form-text text-muted">Select environments where this identifier applies</small>
                </div>

                <br>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Update Identifier
                    </button>
                    <button type="button" class="btn btn-secondary" hx-get="/identifiers/{{ identifier.id }}"
                        hx-target="#pageContent" hx-swap="innerHTML">
                        Cancel
                    </button>
                </div>
            </form>
        </section>
        <br>
    </div>
</div>

<script>
    // Handle successful update
    document.body.addEventListener('htmx:afterSwap', function (evt) {
        if (evt.detail.target.id === 'form-messages' && evt.detail.xhr.status === 200) {
            const content = evt.detail.target.innerHTML;
            if (content.includes('alert-success')) {
                // Success message is already shown, no need to clear form
            }
        }
    });
</script>
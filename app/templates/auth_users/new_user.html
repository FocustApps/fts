<div class="container">
    <button class="btn btn-sm btn-primary" hx-get="{{ url_for(view_url) }}" hx-target="#pageContent"
        hx-swap="innerHTML">
        Back
    </button>
    <div class="container">
        <section style="width: 40vw;">
            <div id="form-messages"></div>
            <form id="createAuthUserForm" hx-post="/auth-users/new" hx-target="#form-messages" hx-swap="innerHTML">
                <h3>Add Authentication User</h3>
                <div class="form-group mb-3">
                    <label for="email" class="form-label">Email Address:</label>
                    <input type="email" id="email" name="email" class="form-control" required
                        placeholder="user@example.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                        title="Please enter a valid email address">
                </div>
                <div class="form-group mb-3">
                    <label for="username" class="form-label">Display Name (optional):</label>
                    <input type="text" id="username" name="username" class="form-control" placeholder="John Doe"
                        maxlength="100">
                </div>
                <div class="form-group mb-3">
                    <label for="password" class="form-label">Password:</label>
                    <input type="password" id="password" name="password" class="form-control" required minlength="8"
                        placeholder="Minimum 8 characters" title="Password must be at least 8 characters">
                </div>
                <div class="form-group mb-3">
                    <label for="account_id" class="form-label">Account:</label>
                    <select id="account_id" name="account_id" class="form-select" required>
                        <option value="">Select an account...</option>
                        {% for account in accounts %}
                        <option value="{{ account.id }}">{{ account.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group mb-3">
                    <div class="form-check">
                        <input type="checkbox" id="is_admin" name="is_admin" class="form-check-input" value="true">
                        <label for="is_admin" class="form-check-label">
                            Admin User
                            <small class="text-muted d-block">Admin users can manage other users</small>
                        </label>
                    </div>
                </div>
                <br>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-person-plus-fill"></i> Add User
                    </button>
                    <button type="button" class="btn btn-secondary" hx-get="{{ url_for(view_url) }}"
                        hx-target="#pageContent" hx-swap="innerHTML">
                        Cancel
                    </button>
                </div>
            </form>
        </section>
        <br>
    </div>
</div>

<script>
    // Reset form after successful submission
    document.body.addEventListener('htmx:afterSwap', function (evt) {
        if (evt.detail.target.id === 'form-messages' && evt.detail.xhr.status === 200) {
            const content = evt.detail.target.innerHTML;
            if (content.includes('alert-success')) {
                // Clear the form on success
                document.getElementById('createAuthUserForm').reset();
            }
        }
    });
</script>
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>Authentication User Details</h3>
        <button class="btn btn-sm btn-primary" hx-get="{{ url_for('get_auth_users_view') }}" hx-target="#pageContent"
            hx-swap="innerHTML">
            Back to Users
        </button>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-3"><strong>Email:</strong></div>
                        <div class="col-sm-9">{{ record.Email }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3"><strong>Username:</strong></div>
                        <div class="col-sm-9">{{ record.Username }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3"><strong>Admin User:</strong></div>
                        <div class="col-sm-9">
                            {% if record["Is Admin"] == "Yes" %}
                            <span class="badge bg-warning">Admin</span>
                            {% else %}
                            <span class="badge bg-secondary">Regular User</span>
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3"><strong>Status:</strong></div>
                        <div class="col-sm-9">
                            {% if record["Is Active"] == "Yes" %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-danger">Inactive</span>
                            {% endif %}
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3"><strong>Created:</strong></div>
                        <div class="col-sm-9">{{ record.Created }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-3"><strong>Last Updated:</strong></div>
                        <div class="col-sm-9">{{ record.Updated }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Token Information</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-sm-5"><strong>Has Token:</strong></div>
                        <div class="col-sm-7">
                            {% if record["Has Current Token"] == "Yes" %}
                            <span class="badge bg-success">Yes</span>
                            {% else %}
                            <span class="badge bg-secondary">No</span>
                            {% endif %}
                        </div>
                    </div>

                    {% if record["Token Expires"] != "â€”" %}
                    <div class="row mb-3">
                        <div class="col-sm-5"><strong>Expires:</strong></div>
                        <div class="col-sm-7">{{ record["Token Expires"] }}</div>
                    </div>
                    {% endif %}

                    <div class="row mb-3">
                        <div class="col-sm-5"><strong>Last Login:</strong></div>
                        <div class="col-sm-7">{{ record["Last Login"] }}</div>
                    </div>

                    <hr>

                    <!-- Action buttons -->
                    <div id="action-messages"></div>

                    {% if record["Is Active"] == "Yes" %}
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary btn-sm" hx-post="/auth-users/{{ record.ID }}/generate-token"
                            hx-target="#action-messages" hx-swap="innerHTML">
                            <i class="bi bi-key"></i> Generate New Token
                        </button>

                        <button class="btn btn-warning btn-sm" hx-post="/auth-users/{{ record.ID }}/deactivate"
                            hx-target="#action-messages" hx-swap="innerHTML"
                            hx-confirm="Are you sure you want to deactivate this user?">
                            <i class="bi bi-person-x"></i> Deactivate User
                        </button>
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        This user is inactive. No actions available.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Auto-refresh page content after successful actions
    document.body.addEventListener('htmx:afterSwap', function (evt) {
        if (evt.detail.target.id === 'action-messages' && evt.detail.xhr.status === 200) {
            const content = evt.detail.target.innerHTML;
            if (content.includes('alert-success')) {
                // Auto-refresh the page after 3 seconds on successful actions
                setTimeout(function () {
                    htmx.ajax('GET', '{{ url_for("view_auth_user", user_id=record.ID) }}', {
                        target: '#pageContent',
                        swap: 'innerHTML'
                    });
                }, 3000);
            }
        }
    });
</script>
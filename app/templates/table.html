{% block title %}
<header class="py-3 mb-4 border-bottom">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">{{ title }}</h4>
            <div class="btn-group" role="group">
                <button class="btn btn-sm btn-info" hx-get={{ url_for(view_url) }} hx-swap="innerHTML"
                    hx-target="#pageContent" type="button">
                    View - {{ title }}
                </button>
                <button class="btn btn-sm btn-primary" hx-get={{ url_for(add_url)}} hx-target="#pageContent"
                    hx-swap="innerHTML" type="button">
                    Add - {{ title }}
                </button>
            </div>
        </div>
</header>
{% endblock %}

{% block content %}
<div class="container">
    <table class="table" id="table">
        {% block table_header %}
        <thead>
            {% for header in headers %}
            <th class="col-{{ header }} themed-grid-col"> {{ header }}</th>
            {% endfor %}
            <th class="col-actions themed-grid-col"> Actions </th>
        </thead>
        {% endblock %}
        {% block table_body %}
        <tbody>
            {% for row in table_rows %}
            <tr class="table-row" id="row-{{table_rows.index(row)}}">
                {% for cell in row %}
                <td class="col-{{ cell[0] }} themed-grid-col">
                    {% set cell_value = cell[-1] %}
                    {% if cell[0] != "url" %}
                    <span class="cell-truncate" title="{{ cell_value }}">{{ cell_value }}</span>
                    {% else %}
                    <a href="{{ cell_value }}" class="cell-truncate" title="{{ cell_value }}" rel="noopener noreferrer"
                        target="_blank">{{ cell_value }}</a>
                    {% endif %}
                </td>
                {% endfor %}
                <td class="col-actions themed-grid-col">
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-xs btn-info" hx-target="#pageContent" hx-swap="innerHTML" hx-get={{
                            url_for(view_record_url, record_id=row.id) }}>
                            View
                        </button>
                        <button class="btn btn-xs btn-primary" hx-confirm="Are you sure?" hx-delete={{
                            url_for(delete_url, record_id=row.id) }} hx-target="closest tr" hx-swap="outerHTML swap:1s">
                            Delete
                        </button>
                    </div>
                </td>
                {% endfor %}
        </tbody>
        {% endblock %}
    </table>
</div>
<style>
    /* Make column widths fixed based on the viewport (container) and not content */
    #table {
        table-layout: fixed;
        width: 100%;
    }

    /* Ensure cells truncate overflowing content with ellipsis */
    #table th,
    #table td {
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: middle;
    }

    /* Truncation wrapper for cell contents (including links) */
    #table .cell-truncate {
        display: inline-block;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        vertical-align: bottom;
    }

    /* Keep the actions column a reasonable fixed width */
    .col-actions {
        width: 10rem;
        /* adjusts with viewport font sizing; tweak as needed */
        white-space: nowrap;
    }

    .env-table-row {
        display: flex;
        justify-content: space-between;
    }

    tr.htmx-swapping td {
        opacity: 0;
        transition: opacity 1s ease-out;
    }
</style>
{% endblock %}